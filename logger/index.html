<!DOCTYPE html>
<html>

    <head>
        <meta charset='utf-8'>
        <title>Read Text File</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
        <script src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" />
    </head>

    <body>
        <div class="metDiv">
            <img class="Met" src="../Imagens/metrics.jpg">
        </div>

        <div class="navBar">
            <a href="/"><b>Check in</b></a>
            <a href="/checkins"><b>View Activity</b></a>
            <a class="active" href="/logger"><b>Key Metrics</b></a>
        </div>
        <br />
        <div class="input">
            <input type="file" name="inputfile" id="inputfile">
        </div>
        <br>

        <div style="width:75%">
            <p>Top Teclas pressionadas:</p>
            <table id="Top10_table" border="1px solid black"></table>
        </div>
        <canvas id="Top10_chart" width="80" height="40"> </canvas>

        <script type="text/javascript">
            var res;
            const arr = [];
            result = {};
            k = []

            document.getElementById('inputfile')
                .addEventListener('change', function () {

                    var fr = new FileReader();
                    fr.onload = function () {
                        /**Parse do ficheiro JSON**/
                        res = JSON.parse(fr.result);
                        
                        const v = Object.entries(res);

                        /**Pôr o timestamp e a key**/
                        for (let i = 0; i < v.length; i++) {
                            arr[i] = v[i][1].Key;
                            //arr.forEach

                        }

                        /**Criar objeto com as keys e o nº de vezes primidas**/
                        let j = 0;
                        for (var i = 0; i < arr.length; ++i) {
                            if (!result[arr[i]]) {
                                result[arr[i]] = 0;
                                k[j] = arr[i];
                                j++;
                            }
                            ++result[arr[i]];
                        }

                        //console.log(Object.entries(result).sort((a, b) => b[1] - a[1]));

                        /** Ordenar por ordem decrescente as keys e seus valores**/
                        Sorted = Object.keys(result).sort(function (a, b) { return result[a] - result[b] })
                        Sorted_val = Object.values(result).sort(function (a, b) { return a - b })

                        console.log(Sorted);

                        console.log(Object.keys(result));
                        console.log(Object.values(result));

                        /**Criar Tabela e Inserir cabeçalho**/
                        const table = document.getElementById("Top10_table");
                        var row_header = table.insertRow(0);
                        row_header.insertCell(0).outerHTML = "<th>Keys</th><th>Nr. de vezes pressionada</th>";
                        var tablerow = 1;

                        /**Inserir valores na tabela por ordem**/
                        for (var i = 0; i < Object.keys(result).length; ++i) {
                            var row = table.insertRow(tablerow);

                            var x = row.insertCell(0);
                            var y = row.insertCell(1);

                            x.innerHTML = Sorted[i];
                            y.innerHTML = Sorted_val[i];
                            
                        }
                    }

                    fr.readAsText(this.files[0]);
                })
           
        </script>
    </body>

</html>
