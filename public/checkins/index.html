<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Temperature</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <script src="utils.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../style.css" />
</head>
<body>
    <div class="tabDiv">
        <img class="Tab" src="../Imagens/tab.jpg">
    </div>
    <div class="navBar">
      <a href="/"><b>Check in</b></a>
      <a class="active" href="/checkins"><b>View Activity</b></a>
    </div>
    <div style="width:100%">
        <canvas id="canvas_temp"></canvas>
        <p id="media"></p>
        <p id="max_temp"></p>
        <p id="min_temp"></p>
        <canvas id="canvas_wind"></canvas>
    </div>
    
    <script>
        var color = Chart.helpers.color;
        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };

        var media = 0;
        var total_media = 0;
        var max = -20;
        var min = 50;
        window.onload = async function() {
            const response = await axios.get('/api');
            var data_temperature = [];
            var data_wind = [];
            for (item of response.data) {
                var date = new Date(item.timestamp).toLocaleString("en-US");
                var temp = item.weather.main.temp;
                var wind_speed = item.weather.wind.speed;
                media += temp;
                total_media++;
                if(temp >= max) max = temp;
                if(temp <= min) min = temp;
                data_temperature.push({
                    x: moment(date),
                    y: temp
                });
                data_wind.push({
                    x: moment(date),
                    y: wind_speed
                });
            }
            
            var scatter_data_temperature = {
            datasets: [{
                label: 'Temperaturas',
                borderColor: window.chartColors.blue,
                backgroundColor: color(window.chartColors.blue).alpha(0.9).rgbString(),
                pointRadius: 4,
                data: data_temperature
            }]};
            
            var scatter_data_wind = {
            datasets: [{
                label: 'Ventos',
                borderColor: window.chartColors.green,
                backgroundColor: color(window.chartColors.blue).alpha(0.9).rgbString(),
                pointRadius: 4,
                data: data_wind
            }]};
            

            var chart_temp = document.getElementById('canvas_temp').getContext('2d');
            window.scatter_temp = new Chart(chart_temp, {
                type: 'scatter',
                data: scatter_data_temperature,
                options: {
                    title: {
                        display: true,
                        text: 'Gráfico de Temperaturas'
                    },
                    scales: {
                        xAxes: [{
                            ticks: {callback: (value) => {return new Date(value).toLocaleString("en-US", {day: "numeric", month: "short", hour: "numeric"});}}
                        }]
                    }
                }
            });

            var chart_wind = document.getElementById('canvas_wind').getContext('2d');
            window.scatter_wind = new Chart(chart_wind, {
                type: 'scatter',
                data: scatter_data_wind,
                options: {
                    title: {
                        display: true,
                        text: 'Gráfico de Velocidade do Vento'
                    },
                    scales: {
                        xAxes: [{
                            ticks: {callback: (value) => {return new Date(value).toLocaleString("en-US", {day: "numeric", month: "short", hour: "numeric"});}}
                        }]
                    }
                }
            });
/*
            var ctx1 = document.getElementById('canvas').getContext('2d');
            window.myScatter1 = new Chart(ctx1, {
                type: 'scatter',
                data: scatterChartData,
                options: {
                    title: {
                        display: true,
                        text: 'Gráfico de Temperaturas'
                    },
                    scales: {
                        xAxes: [{
                            ticks: {callback: (value) => {return new Date(value).toLocaleString("en-US", {day: "numeric", month: "short", hour: "numeric"});}}
                        }]
                    }
                }
            });*/
            
            document.getElementById("media").innerHTML =  "Média de Temperaturas:" + media/total_media;
            document.getElementById("max_temp").innerHTML =  "Temperatura mais alta registada:" + max;
            document.getElementById("min_temp").innerHTML =  "Temperatura mais baixa registada:" + min;
        };

    </script>
</body>
</html>>